/*a9cf17ec02d97e3147f49938f453cf933d17b922*/Ext.define("TripleFitness.controller.GalleryContainerController",{extend:"Ext.app.Controller",config:{refs:{gallery:"#GalleryContainer"}},loadData:function(a){var b=this;this.loadModel("TripleFitness.model.ListModel",a,function(d){var c=d.data.data;Ext.Array.remove(c,c[c.length-1]);b.generateGallery.call(b,c)})},generateGallery:function(b){var a=this.getGallery();a.setStore(Ext.create("Ext.data.Store",{model:"TripleFitness.model.ListItemModel",data:b}))},loadModel:function(b,d,a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){try{Ext.ModelMgr.getModel(b).load(d,{success:a,failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка загрузки данных. Повторите попытку позже.")}})}catch(c){Ext.Msg.alert("Ошибка","Ошибка загрузки данных. Повторите попытку позже.")}finally{}}},});Ext.define("TripleFitness.view.Login",{extend:"Ext.form.Panel",id:"LoginPanel",xtype:"login",requires:["Ext.TitleBar","Ext.form.FieldSet","Ext.field.Email","Ext.field.Password"],config:{title:"Вход",scrollable:true,listeners:{deactivate:function(){this.destroy()}},items:[{xtype:"fieldset",title:"Вход",instructions:"Для входа в систему введите логин и нажмите вход",items:[{xtype:"emailfield",label:"Логин",placeHolder:"email@example.com",name:"user",required:true,id:"txtEmail"}]},{xtype:"container",layout:"hbox",items:[{xtype:"button",text:"Вход",ui:"confirm",flex:1,id:"btnSubmit"},{xtype:"spacer",flex:1},{xtype:"button",text:"Не клиент",flex:1,id:"btnCancel"}]}]}});Ext.define("TripleFitness.view.MainMenu",{extend:"Ext.Container",id:"MainMenu",xtype:"mainmenu",config:{layout:"vbox",items:[{xtype:"container",layout:"hbox",docked:"top",id:"MenuHeader",items:[{xtype:"spacer",flex:2},{html:"<span>&nbsp</span>",flex:3,id:"logo"},{xtype:"spacer",flex:2}]},{xtype:"spacer",flex:1},{xtype:"container",layout:"hbox",flex:2,items:[{xtype:"button",html:"<span>&nbsp</span>",id:"scheduleBtn",flex:1,margin:"2%"},{xtype:"button",html:"<span>&nbsp</span>",id:"fitobarBtn",flex:1,margin:"2%"},{xtype:"button",html:"<span>&nbsp</span>",id:"servicesBtn",flex:1,margin:"2%"}]},{xtype:"container",layout:"hbox",flex:2,items:[{xtype:"button",html:"<span>&nbsp</span>",id:"galleryBtn",flex:1,margin:"2%"},{xtype:"button",html:"<span>&nbsp</span>",id:"newsBtn",flex:1,margin:"2%"},{xtype:"button",html:"<span>&nbsp</span>",id:"infoBtn",flex:1,margin:"2%"}]},{xtype:"spacer",flex:1},{xtype:"container",layout:"hbox",docked:"bottom",id:"MenuFooter"}]}});Ext.define("TripleFitness.view.Cabinet",{extend:"Ext.Container",xtype:"cabinet",id:"CabinetPanel",config:{layout:"card",title:"Кабинет",iconCls:"bookmarks",items:[]}});Ext.define("TripleFitness.view.News",{id:"NewsView",extend:"Ext.Container",xtype:"news",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=TripleFitness.app.getController("NewsController");a.loadData()},config:{layout:"card",items:[{xtype:"list",id:"newsList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}</small></div>',{disableFormats:true}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=TripleFitness.app.getController("NewsController");d.onItemTap(e,b,f,a,c)}}},{xtype:"container",id:"newsDetails",scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true}]}});Ext.define("TripleFitness.view.Info",{id:"InfoView",extend:"Ext.Container",xtype:"info",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=TripleFitness.app.getController("InfoController");a.loadData()},config:{layout:"card",items:[{xtype:"list",id:"infoList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}</small></div>',{disableFormats:true}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=TripleFitness.app.getController("InfoController");d.onItemTap(e,b,f,a,c)}}},{xtype:"container",id:"infoDetails",scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true}]}});Ext.define("TripleFitness.view.Catalog",{id:"CatalogView",extend:"Ext.Container",xtype:"catalog",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=TripleFitness.app.getController("CatalogController");a.loadData()},config:{layout:"card",items:[{xtype:"list",id:"catalogList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}','</small><span class="price"><tpl if="this.isLoggedIn()">{price_club}<tpl else>{price}</tpl> BYR</span></div>',{disableFormats:true,isLoggedIn:function(){return loggedIn}}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=TripleFitness.app.getController("CatalogController");d.onItemTap(e,b,f,a,c)}}},{xtype:"container",id:"catalogDetails",scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,items:[{xtype:"container",id:"catalogDetailsContent"},{xtype:"container",layout:"hbox",items:[{xtype:"button",text:"Заказать",id:"orderBtn",flex:1},{xtype:"container",id:"priceVal",margin:"2%",flex:1}]}]}]}});Ext.define("TripleFitness.view.controls.Header",{id:"Header",extend:"Ext.Container",xtype:"header",config:{docked:"top",layout:"hbox",items:[{xtype:"button",cls:"no_bg",flex:2,html:"<span>&nbsp</span>",id:"backBtnH"},{html:"<span>&nbsp</span>",flex:5,id:"logo1"},{xtype:"button",html:"<span>&nbsp</span>",flex:2,id:"infoBtnH"}]}});Ext.define("TripleFitness.view.controls.Footer",{id:"Footer",extend:"Ext.Container",xtype:"footer",config:{docked:"bottom",layout:"hbox",items:[{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"scheduleBtnF"},{xtype:"button",html:"<span>&nbsp</span>",flex:1,id:"fitobarBtnF"},{xtype:"button",html:"<span>&nbsp</span>",flex:1,id:"servicesBtnF"},{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"galleryBtnF"},{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"newsBtnF"}]}});Ext.define("TripleFitness.model.EntryModel",{extend:"Ext.data.Model",config:{fields:["id","title","headline","content"],proxy:{type:"ajax",url:"http://evo.sib.by/export.html",reader:{type:"json"}}}});Ext.define("TripleFitness.model.ListModel",{extend:"Ext.data.Model",config:{fields:["id","pagetitle","description","img","content","data"],hasMany:{model:"TripleFitness.model.ListItemModel",name:"data"},proxy:{type:"ajax",url:"http://evo.sib.by/export.html",reader:{type:"json"}}}});Ext.define("TripleFitness.model.ListItemModel",{extend:"Ext.data.Model",config:{fields:["id","title","description","img","content","leaf","list","thumb","price_club","price"],belongsTo:"TripleFitness.model.ListModel",hasMany:{model:"TripleFitness.model.ListItemModel",name:"list"}}});Ext.define("TripleFitness.view.GalleryContainer",{id:"GalleryContainer",extend:"Ext.dataview.DataView",xtype:"galleryContainer",initialize:function(){this.callParent();var a=TripleFitness.app.getController("GalleryContainerController");a.loadData()},requires:["Ext.data.Store"],config:{itemTpl:new Ext.XTemplate("<h1>{title}</h1>",{disableFormats:true}),}});Ext.define("TripleFitness.controller.LoginController",{extend:Ext.app.Controller,requires:["TripleFitness.view.Cabinet"],config:{refs:{mainView:"#MainView",mainPanel:"#MainPanel",mainMenuRow1:"#MainMenuRow1",btnSubmit:"#btnSubmit",btnCancel:"#btnCancel",txtEmail:"#txtEmail"},control:{btnSubmit:{tap:"onSubmit"},btnCancel:{tap:"onCancel"}}},emailValidator:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,onSubmit:function(){loggedIn=true;this.getMainView().setActiveItem(1)},onCancel:function(){this.getMainView().setActiveItem(1)}});Ext.define("TripleFitness.view.MainContainer",{id:"MainContainer",extend:"Ext.Container",xtype:"maincontainer",requires:["TripleFitness.view.controls.Header","TripleFitness.view.controls.Footer"],config:{autoDestroy:true,listeners:{deactivate:function(a){a.removeAt(2)}},layout:"fit",items:[{xtype:"header"},{xtype:"footer"}]}});Ext.define("TripleFitness.view.Main",{extend:"Ext.Container",fullscreen:true,requires:["TripleFitness.view.Login","TripleFitness.view.MainMenu","TripleFitness.view.MainContainer"],id:"MainView",config:{layout:"card",items:[{xtype:"login"},{xtype:"container",id:"MainPanel",layout:"card",items:[{xtype:"mainmenu"},{xtype:"maincontainer"}]}]}});Ext.define("TripleFitness.controller.ListBaseController",{extend:"Ext.app.Controller",requires:["TripleFitness.model.EntryModel","TripleFitness.model.ListModel","TripleFitness.model.ListItemModel"],config:{refs:{listView:"",listViewContainer:"",backBtn:""}},listModelId:undefined,getDetailsCardContent:function(a){return a.data.content},postLaunch:function(b,a){},buildStore:function(b,a){b.setStore(Ext.create("Ext.data.Store",{model:"TripleFitness.model.ListItemModel",data:a}))},launch:function(){this.callParent(arguments)},loadData:function(){var b=this.getListView();var c=this.listModelId;if(!c){throw"You should specify you model id in derrived class to retrive appropriate data from service!"}var a=this;this.loadModel("TripleFitness.model.ListModel",c,function(d){a.processProperties(d.data.data);a.buildStore(b,d.data.data);a.on({postLaunch:a.postLaunch});a.fireEvent("postLaunch",b,d.data.data)})},processProperties:function(b){var a=this;Ext.each(b,function(e,d,f){if(f[d].id){if(f[d].title==""){f[d].title=f[d].pagetitle}f[d].leaf=(f[d].leaf=="1");var c=f[d].list;if(c){a.processProperties(c)}}else{Ext.Array.remove(f,e)}})},loadModel:function(b,d,a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){try{Ext.ModelMgr.getModel(b).load(d,{success:a,failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка загрузки данных. Повторите попытку позже.")}})}catch(c){Ext.Msg.alert("Ошибка","Ошибка загрузки данных. Повторите попытку позже.")}finally{}}},onItemTap:function(f,b,g,a,c){if(a.get("leaf")==true){var h=this.getListViewContainer();var e=a.get("id");var d=this;this.loadModel("TripleFitness.model.EntryModel",e,function(i){h.getAt(1).setHtml(d.getDetailsCardContent(i));h.setActiveItem(1);d.getBackBtn().removeCls("no_bg")})}}});Ext.define("TripleFitness.controller.NewsController",{extend:"TripleFitness.controller.ListBaseController",config:{refs:{listView:"#newsList",listViewContainer:"#NewsView",backBtn:"#backBtnH"}},listModelId:174});Ext.define("TripleFitness.controller.InfoController",{extend:"TripleFitness.controller.ListBaseController",config:{refs:{listView:"#infoList",listViewContainer:"#InfoView",backBtn:"#backBtnH"}},listModelId:176});Ext.define("TripleFitness.controller.GalleryController",{extend:"TripleFitness.controller.ListBaseController",config:{refs:{listView:"#galleryList",listViewContainer:"#Gallery",backBtn:"#backBtnH"}},listModelId:231});Ext.define("TripleFitness.controller.CatalogController",{extend:"TripleFitness.controller.ListBaseController",config:{refs:{listView:"#catalogList",listViewContainer:"#CatalogView",backBtn:"#backBtnH",priceVal:"#priceVal"}},listModelId:243,detailsTpl:new Ext.XTemplate('<div class="judge-details-item"><h4>{title}</h4><tpl if="img"><img src="{img}"/></tpl><small>{description}',"</small></div>",{disableFormats:true,isLoggedIn:function(){return loggedIn}}),onItemTap:function(e,b,f,a,c){if(a.get("leaf")==true){var g=this.getListViewContainer();this.detailsTpl.overwrite(Ext.get("catalogDetailsContent"),a.data);var d=loggedIn?a.get("price_club"):a.get("price");this.getPriceVal().setHtml('<span class="price-hack">'+d+" BYR</span>");g.setActiveItem(1);this.getBackBtn().removeCls("no_bg")}}});Ext.define("TripleFitness.view.Gallery",{id:"Gallery",extend:"Ext.Container",xtype:"gallery",requires:["Ext.data.Store","TripleFitness.view.GalleryContainer"],initialize:function(){this.callParent();var a=TripleFitness.app.getController("GalleryController");a.loadData()},config:{layout:"card",items:[{xtype:"list",id:"galleryList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}</small></div>',{disableFormats:true}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,c,f,b,d){var a=TripleFitness.app.getController("GalleryContainerController");a.loadData(b.get("id"));this.parent.setActiveItem(1);Ext.get("backBtnH").removeCls("no_bg")}}},{xtype:"galleryContainer"}]}});Ext.define("TripleFitness.controller.MainMenuController",{extend:Ext.app.Controller,requires:["TripleFitness.view.Cabinet","TripleFitness.view.News","TripleFitness.view.Info","TripleFitness.view.Catalog","TripleFitness.view.Gallery"],config:{refs:{mainPanel:"#MainPanel",mainContainer:"#MainContainer",btnGallery:"#galleryBtn",btnNews:"#newsBtn",btnInfo:"#infoBtn",btnServices:"#servicesBtn",btnGalleryF:"#galleryBtnF",btnNewsF:"#newsBtnF",btnServicesF:"#servicesBtnF",btnInfoH:"#infoBtnH",btnBackH:"#backBtnH"},control:{btnGallery:{tap:"onGallery"},btnNews:{tap:"onNews"},btnInfo:{tap:"onInfo"},btnServices:{tap:"onServices"},btnGalleryF:{tap:"onGalleryF"},btnNewsF:{tap:"onNewsF"},btnServicesF:{tap:"onServicesF"},btnInfoH:{tap:"onInfoH"},btnBackH:{tap:"onBackH"}}},removeActiveCls:function(){Ext.select("#Footer div.x-layout-box-item, #Header div.x-layout-box-item").removeCls("active")},onGallery:function(){this.switchToGallery();this.getMainPanel().setActiveItem(1)},onServices:function(){this.switchToServices();this.getMainPanel().setActiveItem(1)},onInfo:function(){this.switchToInfo();this.getMainPanel().setActiveItem(1)},onNews:function(){this.switchToNews();this.getMainPanel().setActiveItem(1)},onInfoH:function(a){this.switchToInfo()},onBackH:function(){var b=this.getMainContainer().getActiveItem();var a=b.getId();if(Ext.get(this.getBtnBackH().getId()).hasCls("no_bg")==false&&(a=="NewsView"||a=="InfoView"||a=="CatalogView"||a=="Gallery")){b.getAt(1).setHtml("");b.setActiveItem(0);this.getBtnBackH().addCls("no_bg")}},onGalleryF:function(a){this.switchToGallery()},onServicesF:function(a){this.switchToServices()},onNewsF:function(a){this.switchToNews()},switchToInfo:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"info"});this.removeActiveCls();this.getBtnInfoH().addCls("active")},switchToServices:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"catalog"});this.removeActiveCls();this.getBtnServicesF().addCls("active")},switchToGallery:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"gallery"});this.removeActiveCls();this.getBtnGalleryF().addCls("active")},switchToNews:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"news"});this.removeActiveCls();this.getBtnNewsF().addCls("active")}});Ext.Loader.setPath({Ext:"sdk/src"});Ext.application({name:"TripleFitness",isIconPrecomposed:true,views:["Main"],controllers:["NewsController","InfoController","LoginController","MainMenuController","GalleryController","CatalogController","GalleryContainerController",],phoneStartupScreen:"resources/loading/Homescreen.jpg",tabletStartupScreen:"resources/loading/Homescreen~ipad.jpg",launch:function(){Ext.fly("appLoadingIndicator").destroy();if(navigator.network&&navigator.network.connection){if(navigator.network.connection.type==Connection.NONE){Ext.Msg.alert("������",GlobalMessages.NoInetOfflineMode)}else{var a=Ext.create("Ext.LoadMask",{message:GlobalMessages.LoadingData,id:"loading"});Ext.Viewport.add(a);a.hide();Ext.Ajax.on("beforerequest",function(){a.show()});Ext.Ajax.on("requestcomplete",function(){a.hide()});Ext.Ajax.on("requestexception",function(){a.hide()})}}Ext.Viewport.add(Ext.create("TripleFitness.view.Main"))},onUpdated:function(){window.location.reload()}});var loggedIn=false;