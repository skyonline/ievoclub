/*7b9ebcfaf1eaff6b38957fd25ce1387c11c9139d*/Ext.define("TripleFitness.controller.LoginController",{extend:Ext.app.Controller,config:{refs:{mainView:"#MainView",btnSubmit:"#btnSubmit",btnCancel:"#btnCancel",txtEmail:"#txtEmail"},control:{btnSubmit:{tap:"onSubmit"},btnCancel:{tap:"onCancel"}}},emailValidator:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,emailValue:"",onSubmit:function(){var b=this;var a=this.getTxtEmail().getValue();if(this.emailValidator.test(a)){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){Ext.Ajax.request({url:"http://evo.sib.by/user.html",method:"POST",params:{user:a,key:"abc"},success:function(c){if(c.responseText!="0"){userId=parseInt(c.responseText);Ext.select("#loggedAs span.loggedAsUserName").setHtml(a);b.getMainView().setActiveItem(1);b.emailValue=a}else{Ext.Msg.alert("Ошибка","Введен неверный логин либо аккаунт не активирован.")}},failure:function(){Ext.Msg.alert("Ошибка","Вход невозможен. Ошибка подключения.")}})}else{Ext.Msg.alert("Ошибка","Вход невозможен. Отсутствует подключение к интернету.")}}else{Ext.Msg.alert("Ошибка","Введен неверный логин.")}},onCancel:function(){this.getMainView().setActiveItem(1)}});Ext.define("TripleFitness.controller.GalleryContainerController",{extend:"Ext.app.Controller",config:{refs:{imageList:"#imageList",imageEntry:"#imageEntry"}},loadData:function(a){var b=this;this.loadModel("TripleFitness.model.ListModel",a,function(d){var c=d.data.data;Ext.Array.remove(c,c[c.length-1]);b.generateGallery.call(b,c)})},generateGallery:function(d){var b=this.getImageEntry();var a=new Ext.Template('<div style="background: url({img}) center no-repeat;background-size:contain; width:{width}px;height:{height}px"></div>');Ext.each(d,function(g,f){var e=a.apply({img:g.img,width:320,height:280});b.insert(f,{html:e})});var c=this.getImageList();c.setStore(Ext.create("Ext.data.Store",{model:"TripleFitness.model.ListItemModel",data:d}))},loadModel:function(b,d,a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){try{Ext.ModelMgr.getModel(b).load(d,{success:a,failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка загрузки данных. Повторите попытку позже.")}})}catch(c){Ext.Msg.alert("Ошибка","Ошибка загрузки данных. Повторите попытку позже.")}finally{}}},});Ext.define("TripleFitness.view.Login",{extend:"Ext.Container",id:"LoginPanel",xtype:"login",requires:["Ext.TitleBar","Ext.form.FieldSet","Ext.field.Email","Ext.field.Password"],config:{layout:"vbox",scrollable:false,listeners:{deactivate:function(){this.destroy()}},items:[{xtype:"spacer",flex:1},{xtype:"container",flex:2,layout:"hbox",items:[{xtype:"spacer",flex:1},{xtype:"container",flex:10,layout:"vbox",id:"loginContainer",items:[{xtype:"spacer",flex:1},{flex:1,html:"<span>&nbsp</span>",id:"loginTitle"},{xtype:"spacer",flex:1},{xtype:"emailfield",flex:0.5,placeHolder:"example@example.com",name:"user",required:true,id:"txtEmail",height:"30%"},{xtype:"spacer",flex:1},{xtype:"button",flex:3,html:"<span>&nbsp</span>",id:"btnSubmit",},{xtype:"spacer",flex:1,html:"<div>&nbsp;</div>",id:"spaceLine"},{xtype:"button",flex:3,html:"<span>&nbsp</span>",id:"btnCancel"},]},{xtype:"spacer",flex:1}]},{xtype:"spacer",flex:1}]}});Ext.define("TripleFitness.view.MainMenu",{extend:"Ext.Container",id:"MainMenu",xtype:"mainmenu",config:{layout:"vbox",items:[{xtype:"container",layout:"hbox",docked:"top",id:"MenuHeader",items:[{xtype:"spacer",flex:2},{html:"<span>&nbsp</span>",flex:3,id:"logo"},{xtype:"spacer",flex:2}]},{xtype:"spacer",flex:1},{xtype:"container",layout:"hbox",flex:2,items:[{xtype:"button",html:"<span>&nbsp</span>",id:"scheduleBtn",flex:1,margin:"2%"},{xtype:"button",html:"<span>&nbsp</span>",id:"fitobarBtn",flex:1,margin:"2%"},{xtype:"button",html:"<span>&nbsp</span>",id:"servicesBtn",flex:1,margin:"2%"}]},{xtype:"container",layout:"hbox",flex:2,items:[{xtype:"button",html:"<span>&nbsp</span>",id:"galleryBtn",flex:1,margin:"2%"},{xtype:"button",html:"<span>&nbsp</span>",id:"newsBtn",flex:1,margin:"2%"},{xtype:"button",html:"<span>&nbsp</span>",id:"infoBtn",flex:1,margin:"2%"}]},{xtype:"container",layout:"hbox",flex:2,items:[{xtype:"button",html:"<span>&nbsp</span>",id:"magazineBtn",flex:1,margin:"2%"},{xtype:"button",html:"<span>&nbsp</span>",id:"consultingBtn",flex:1,margin:"2%"},{xtype:"button",html:"<span>&nbsp</span>",id:"tourBtn",flex:1,margin:"2%"}]},{xtype:"spacer",flex:1},{xtype:"container",docked:"bottom",layout:{type:"hbox",align:"center",pack:"center"},id:"MenuFooter",items:[{xtype:"container",id:"loggedAs",html:'<span class="loggedAs">Вы вошли как </span><span class="loggedAsUserName">Гость</span>'}]}]}});Ext.define("TripleFitness.view.News",{id:"NewsView",extend:"Ext.Container",xtype:"news",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=TripleFitness.app.getController("NewsController");a.loadData()},config:{layout:"card",items:[{xtype:"list",id:"newsList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}</small></div>',{disableFormats:true}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=TripleFitness.app.getController("NewsController");d.onItemTap(e,b,f,a,c)}}},{xtype:"container",id:"newsDetails",scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true}]}});Ext.define("TripleFitness.view.Info",{id:"InfoView",extend:"Ext.Container",xtype:"info",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=TripleFitness.app.getController("InfoController");a.loadData()},config:{layout:"card",items:[{xtype:"list",id:"infoList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}</small></div>',{disableFormats:true}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=TripleFitness.app.getController("InfoController");d.onItemTap(e,b,f,a,c)}}},{xtype:"container",id:"infoDetails",scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true}]}});Ext.define("TripleFitness.view.Catalog",{id:"CatalogView",extend:"Ext.Container",xtype:"catalog",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=TripleFitness.app.getController("CatalogController");a.loadData()},config:{layout:"card",items:[{xtype:"list",id:"catalogList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}','</small><tpl if="price"><span class="price">{[this.formatPrice(values.price)]}</span></tpl></div>',{disableFormats:true,isLoggedIn:function(){return userId>0},formatPrice:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=TripleFitness.app.getController("CatalogController");d.onItemTap(e,b,f,a,c)}}},{xtype:"container",id:"catalogDetails",cls:"x-html",scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,items:[{xtype:"container",id:"catalogDetailsContent"},{xtype:"hiddenfield",id:"catalogItemId"},{xtype:"container",layout:"hbox",items:[{xtype:"button",text:"Заказать",id:"orderBtn",flex:1,listeners:{tap:function(){var a=TripleFitness.app.getController("CatalogController");a.showCatalogMessageDialog()}}},{xtype:"container",id:"priceVal",margin:"2%",flex:2}]}]}]}});Ext.define("TripleFitness.view.CatalogMessageDialog",{extend:"Ext.MessageBox",id:"CatalogMessageDialog",xtype:"catalogMessage",config:{items:[{xtype:"fieldset",height:"20em",scrollable:{direction:"vertical",directionLock:true},items:[{xtype:"datepickerfield",id:"catalogDate",name:"catalogDate",label:"Дата",value:new Date(),labelAlign:"top",required:true,dateFormat:"d/m/Y",picker:{cancelButton:GlobalMessages.Cancel,doneButton:GlobalMessages.Done},listeners:{change:function(){var a=TripleFitness.app.getController("CatalogController");a.setSpecialistData()}}},{xtype:"selectfield",id:"catalogTime",name:"catalogTime",label:"Время",labelAlign:"top",required:true,usePicker:true,defaultPhonePickerConfig:{cancelButton:GlobalMessages.Cancel,doneButton:GlobalMessages.Done},defaultTabletPickerConfig:{cancelButton:GlobalMessages.Cancel,doneButton:GlobalMessages.Done},options:[{text:"Время",value:""},{text:"8.00",value:"8.00"},{text:"9.00",value:"9.00"},{text:"10.00",value:"10.00"},{text:"11.00",value:"11.00"},{text:"12.00",value:"12.00"},{text:"13.00",value:"13.00"},{text:"14.00",value:"14.00"},{text:"15.00",value:"15.00"},{text:"16.00",value:"16.00"},{text:"17.00",value:"17.00"},{text:"18.00",value:"18.00"},{text:"19.00",value:"19.00"},{text:"20.00",value:"20.00"},{text:"21.00",value:"21.00"},{text:"22.00",value:"22.00"}],value:"",listeners:{change:function(){var a=TripleFitness.app.getController("CatalogController");a.setSpecialistData()}}},{xtype:"selectfield",id:"catalogSpecialist",name:"catalogSpecialist",label:"Специалист",labelAlign:"top",required:false,usePicker:false,options:[]},{xtype:"textfield",id:"catalogName",name:"catalogName",label:"Имя",labelAlign:"top",required:true,maxLength:50,hidden:true},{xtype:"textfield",id:"catalogPhone",name:"catalogPhone",label:"Телефон",labelAlign:"top",required:true,maxLength:15,hidden:true},{xtype:"textareafield",id:"catalogRemarks",name:"catalogRemarks",label:"Заметки",labelAlign:"top",required:false,maxLength:200,resizable:true}]},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",text:"Отправить",ui:"action",align:"start",listeners:{tap:function(){var a=TripleFitness.app.getController("CatalogController");a.sendCatalogMessage()}}},{xtype:"spacer"},{xtype:"button",text:"Отмена",ui:"action",align:"end",listeners:{tap:function(){var a=TripleFitness.app.getController("CatalogController");a.hideCatalogMessageDialog()}}}]}]}});Ext.define("TripleFitness.view.Schedule",{extend:"Ext.Container",xtype:"schedule",id:"ScheduleView",requires:["Ext.data.Store"],initialize:function(){this.callParent();controller=TripleFitness.app.getController("ScheduleController");controller.loadData()},controller:null,config:{layout:"vbox",items:[{xtype:"list",flex:5,id:"ScheduleList",itemTpl:new Ext.XTemplate('<div class="schedule-list-item"><span class="time">{time}</span><div style="display:inline-block; width:78%; vertical-align: middle;" class="{[this.getRowStyle(values.infozal)]}"><h4>{title}</h4><small class="trainer">Тренер: {trainer}. {infozal}.</small><small class="desc">{description}</small></div></div>',{disableFormats:true,getRowStyle:function(a){switch(a){case"Зал 1":return"gym-1";break;case"Зал 2":return"gym-2";break;case"Водные программы":return"gym-3";break}}}),scrollable:{direction:"vertical",directionLock:true},listeners:{itemtap:function(d,b,e,a,c){controller=TripleFitness.app.getController("ScheduleController");controller.orderScheduleItem(a)}}},{xtype:"container",layout:"hbox",flex:1,items:[{xtype:"button",text:"ПН",id:"btnMonday",flex:1,listeners:{tap:function(){controller.filterList(this)}}},{xtype:"button",text:"ВТ",flex:1,listeners:{tap:function(){controller.filterList(this)}}},{xtype:"button",text:"СР",flex:1,listeners:{tap:function(){controller.filterList(this)}}},{xtype:"button",text:"ЧТ",flex:1,listeners:{tap:function(){controller.filterList(this)}}},{xtype:"button",text:"ПТ",flex:1,listeners:{tap:function(){controller.filterList(this)}}},{xtype:"button",text:"СБ",flex:1,listeners:{tap:function(){controller.filterList(this)}}},{xtype:"button",text:"ВС",flex:1,listeners:{tap:function(){controller.filterList(this)}}}]}]}});Ext.define("TripleFitness.view.Fitobar",{id:"FitobarView",extend:"Ext.Container",xtype:"fitobar",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=TripleFitness.app.getController("FitobarController");a.loadData()},config:{layout:"card",items:[{xtype:"list",id:"fitobarList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}','</small><tpl if="price"><span class="price"><tpl if="this.isLoggedIn()">{[this.formatPrice(values.price_club)]}<tpl else>{[this.formatPrice(values.price)]}</tpl></span></tpl></div>',{disableFormats:true,isLoggedIn:function(){return userId>0},formatPrice:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=TripleFitness.app.getController("FitobarController");d.onItemTap(e,b,f,a,c)}}},{xtype:"container",id:"fitobarDetails",cls:"x-html",scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,items:[{xtype:"container",id:"fitobarDetailsContent"},{xtype:"hiddenfield",id:"fitobarItemId"},{xtype:"container",layout:"hbox",items:[{xtype:"button",text:"Заказать",id:"orderBtn",flex:1,listeners:{tap:function(){var a=TripleFitness.app.getController("FitobarController");a.orderBarItem()}}},{xtype:"container",id:"priceVal",margin:"2%",flex:1}]}]}]}});Ext.define("TripleFitness.view.Consulting",{extend:"Ext.Container",id:"ConsaltingView",xtype:"consulting",initialize:function(){this.callParent();if(userId>0){var a=TripleFitness.app.getController("ConsultingController");a.loadModel()}else{this.removeAt(1);Ext.getCmp("ConsaltingView").setHtml("Данная информация доступна только клиентам")}},config:{layout:"card"}});Ext.define("TripleFitness.view.ConsultingMessageDialog",{extend:"Ext.Panel",id:"ConsultingMessageDialog",xtype:"consultingMessage",config:{style:"z-index:9",zIndex:"9",items:[{xtype:"fieldset",items:[{xtype:"textfield",id:"consultSubject",name:"consultSubject",label:"Заголовок",labelAlign:"top",required:true},{xtype:"textareafield",id:"consultBody",name:"consultBody",label:"Текст сообщения",labelAlign:"top",required:true}]},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",text:"Отправить",ui:"action",align:"start",listeners:{tap:function(){var a=TripleFitness.app.getController("ConsultingController");a.sendConsultMessage()}}},{xtype:"spacer"},{xtype:"button",text:"Отмена",ui:"action",align:"end",listeners:{tap:function(){var a=TripleFitness.app.getController("ConsultingController");a.hideSendMessageDialog()}}}]}]}});Ext.define("TripleFitness.view.Tour",{extend:"Ext.Container",id:"TourView",xtype:"tour",config:{html:'<iframe src="http://evo.sib.by/3d.html" style="width: 100%; height: 100%; border:none;" id="ext-element-65"></iframe>'}});Ext.define("TripleFitness.model.ListModel",{extend:"Ext.data.Model",config:{fields:["id","pagetitle","description","img","content","data"],hasMany:{model:"TripleFitness.model.ListItemModel",name:"data"},proxy:{type:"ajax",url:"http://evo.sib.by/export.html",reader:{type:"json"}}}});Ext.define("TripleFitness.model.ListItemModel",{extend:"Ext.data.Model",config:{fields:["id","title","description","img","content","leaf","list","thumb","price_club","price","time","infozal","trainer","day",{name:"start",type:"date",dateFormat:"c"},{name:"end",type:"date",dateFormat:"c"}],belongsTo:"TripleFitness.model.ListModel",hasMany:{model:"TripleFitness.model.ListItemModel",name:"list"}}});Ext.define("TripleFitness.model.EntryModel",{extend:"Ext.data.Model",config:{fields:["id","title","headline","content"],proxy:{type:"ajax",url:"http://evo.sib.by/export.html",reader:{type:"json"}}}});Ext.define("TripleFitness.model.CatalogModel",{extend:"Ext.data.Model",config:{fields:["id","pagetitle","description","img","content","data"],hasMany:{model:"TripleFitness.model.ListItemModel",name:"data"},proxy:{type:"ajax",url:"http://mail2.evo-club.by:8080/EvoWebJSON/Service.asmx/GetService",reader:{type:"json",rootProperty:"d"},headers:{"Content-type":"application/json"}}}});Ext.define("TripleFitness.model.SpecialistModel",{extend:"Ext.data.Model",config:{fields:[{name:"text",mapping:"title"},{name:"value",mapping:"id"}]}});Ext.define("TripleFitness.view.controls.Header",{id:"Header",extend:"Ext.Container",xtype:"header",config:{docked:"top",layout:"hbox",items:[{xtype:"button",cls:"no_bg",flex:2,html:"<span>&nbsp</span>",id:"backBtnH"},{html:"<span>&nbsp</span>",flex:5,id:"logo1"},{xtype:"button",html:"<span>&nbsp</span>",flex:2,id:"infoBtnH"}]}});Ext.define("TripleFitness.view.controls.Footer",{id:"Footer",extend:"Ext.Container",xtype:"footer",config:{docked:"bottom",layout:"hbox",items:[{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"scheduleBtnF"},{xtype:"button",html:"<span>&nbsp</span>",flex:1,id:"fitobarBtnF"},{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"consultingBtnF"},{xtype:"button",html:"<span>&nbsp</span>",flex:1,id:"servicesBtnF"},{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"magazineBtnF"}]}});Ext.define("TripleFitness.view.GalleryContainer",{id:"GalleryContainer",extend:"Ext.Container",xtype:"galleryContainer",requires:["Ext.data.Store"],config:{layout:"card",items:[{xtype:"dataview",id:"imageList",itemTpl:new Ext.XTemplate('<div class="image-item" style="background:url({thumb}) center no-repeat"></div>',{disableFormats:true}),listeners:{itemtap:function(b,c,e,a,d){this.parent.getAt(1).setActiveItem(c);this.parent.setActiveItem(1)}}},{xtype:"carousel",indicator:false,id:"imageEntry",width:"100%",height:"100%"}],listeners:{deactivate:function(){this.destroy()}}}});Ext.define("TripleFitness.view.MagazineList",{extend:"Ext.Container",xtype:"magazinelist",id:"MagazineListView",requires:["Ext.data.Store","Ext.Carousel"],controller:null,config:{layout:"card",items:[{xtype:"container",layout:"vbox",scrollable:{direction:"vertical",directionLock:true},items:[{xtype:"carousel",id:"atrcilepreview",indicator:false,height:"220px"},{xtype:"list",layout:"fit",itemTpl:new Ext.XTemplate('<div class="judge-list-item magazine-article-item"><tpl if="img"><div class="magazine-list-item-img" style="background: url({img}) center no-repeat;background-size:contain"></div></tpl><h4>{title}</h4><small>{description}',"</small></div>",{disableFormats:true}),scrollable:false,styleHtmlContent:true,id:"articlelist",listeners:{itemtap:function(d,b,e,a){var c=TripleFitness.app.getController("MagazineMainController");c.loadArticleContent(a)}}}]}],listeners:{deactivate:function(){this.destroy()}}}});Ext.define("TripleFitness.controller.ConsultingController",{extend:"Ext.app.Controller",requires:["TripleFitness.model.EntryModel"],config:{refs:{consultingView:"#ConsaltingView"}},detailsTpl:new Ext.XTemplate('<div class="border"><h4 class="typecard">{typecard}</h4><div id="spaceLine"><div></div></div><div class="ballance">Балланс: <span>{balance}</span></div><div id="spaceLine"><div></div></div><small>{descr}</small><div id="spaceLine"><div></div></div><small>Срок действия: <span class="term">{datefrom} - {dateto}<span></small></div>',{disableFormats:true}),loadModel:function(){var a=this;if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){try{Ext.Ajax.request({url:"http://mail2.evo-club.by:8080/EvoWebJSON/Service.asmx/GetClient",method:"GET",params:{name:'"client1811"',password:'"s6INeP3"'},success:function(c){a.getConsultingView().setHtml(a.detailsTpl.apply(JSON.parse(c.responseText).d))},failure:function(){Ext.Msg.alert("Ошибка","Ошибка получения данных. Повторите попытку позже.")},headers:{"Content-type":"application/json"}})}catch(b){Ext.Msg.alert("Ошибка","Ошибка загрузки данных. Повторите попытку позже.")}finally{}}},showSendMessageDialog:function(){this.showSendMessageDialogRef=Ext.create("TripleFitness.view.ConsultingMessageDialog");Ext.Viewport.add(this.showSendMessageDialogRef)},showSendMessageDialogRef:null,hideSendMessageDialog:function(){Ext.Viewport.remove(this.showSendMessageDialogRef,true)},sendConsultMessage:function(){var b=Ext.getCmp("consultSubject").getValue();var a=Ext.getCmp("consultBody").getValue();if(b&&a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){Ext.Ajax.request({url:"http://evo.sib.by/consult.html",method:"POST",params:{subject:b,body:a,userId:userId},success:function(c){Ext.Msg.alert("Информация","Ваше сообщение отправлено.")},failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка, попробуйте отправить сообщение позже.")}})}else{Ext.Msg.alert("Ошибка","Отсутствует подключение к интернету.")}Ext.Viewport.remove(this.showSendMessageDialogRef,true)}else{Ext.Msg.alert("Ошибка","Пожалуйста, введите заголовок и текст сообщения.")}}});Ext.define("TripleFitness.view.MainContainer",{id:"MainContainer",extend:"Ext.Container",xtype:"maincontainer",requires:["TripleFitness.view.controls.Header","TripleFitness.view.controls.Footer"],config:{autoDestroy:true,listeners:{deactivate:function(a){a.removeAt(2)}},layout:"fit",items:[{xtype:"header"},{xtype:"footer"}]}});Ext.define("TripleFitness.view.Main",{extend:"Ext.Container",fullscreen:true,requires:["TripleFitness.view.Login","TripleFitness.view.MainMenu","TripleFitness.view.MainContainer"],id:"MainView",config:{layout:"card",items:[{xtype:"login"},{xtype:"container",id:"MainPanel",layout:"card",items:[{xtype:"mainmenu"},{xtype:"maincontainer"}]}]}});Ext.define("TripleFitness.controller.ListBaseController",{extend:"Ext.app.Controller",requires:["TripleFitness.model.EntryModel","TripleFitness.model.ListModel","TripleFitness.model.ListItemModel"],config:{refs:{listView:"",listViewContainer:"",backBtn:""}},listModelId:undefined,getDetailsCardContent:function(a){return a.data.content},buildStore:function(b,a){b.setStore(Ext.create("Ext.data.Store",{model:"TripleFitness.model.ListItemModel",data:a}))},getModelName:function(){return"TripleFitness.model.ListModel"},loadData:function(){var b=this.getListView();var c=this.listModelId;var a=this;this.loadModel(this.getModelName(),c,function(d){a.processProperties(d.data.data);a.buildStore(b,d.data.data)})},processProperties:function(b){var a=this;Ext.each(b,function(e,d,f){if(f[d].id){if(f[d].title==""){f[d].title=f[d].pagetitle}f[d].leaf=(f[d].leaf=="1");var c=f[d].list;if(c){a.processProperties(c)}}else{Ext.Array.remove(f,e)}})},prepareToLoad:function(a){return},loadModel:function(b,f,a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){try{var c=Ext.ModelMgr.getModel(b);this.prepareToLoad(c);c.load(f,{success:a,failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка загрузки данных. Повторите попытку позже.")}})}catch(d){Ext.Msg.alert("Ошибка","Ошибка загрузки данных. Повторите попытку позже.")}finally{}}},onItemTap:function(f,b,g,a,c){if(a.get("leaf")==true){var h=this.getListViewContainer();var e=a.get("id");var d=this;this.loadModel("TripleFitness.model.EntryModel",e,function(i){h.getAt(1).setHtml(d.getDetailsCardContent(i));h.setActiveItem(1);d.getBackBtn().removeCls("no_bg")})}}});Ext.define("TripleFitness.controller.NewsController",{extend:"TripleFitness.controller.ListBaseController",config:{refs:{listView:"#newsList",listViewContainer:"#NewsView",backBtn:"#backBtnH"}},listModelId:174});Ext.define("TripleFitness.controller.InfoController",{extend:"TripleFitness.controller.ListBaseController",config:{refs:{listView:"#infoList",listViewContainer:"#InfoView",backBtn:"#backBtnH"}},listModelId:176});Ext.define("TripleFitness.controller.GalleryController",{extend:"TripleFitness.controller.ListBaseController",config:{refs:{listView:"#galleryList",listViewContainer:"#Gallery",backBtn:"#backBtnH"}},listModelId:231});Ext.define("TripleFitness.controller.CatalogController",{extend:"TripleFitness.controller.ListBaseController",requires:["TripleFitness.model.EntryModel","TripleFitness.model.CatalogModel","TripleFitness.model.ListItemModel","TripleFitness.model.SpecialistModel"],config:{refs:{listView:"#catalogList",listViewContainer:"#CatalogView",backBtn:"#backBtnH",priceVal:"#priceVal"}},listModelId:0,launch:function(){this.callParent(arguments);this.specialistsStore=Ext.create("Ext.data.Store",{autoload:false,model:"TripleFitness.model.SpecialistModel",proxy:{type:"ajax",url:"http://mail2.evo-club.by:8080/EvoWebJSON/Service.asmx/GetServiceDetail",reader:{type:"json",rootProperty:"d.detail"},headers:{"Content-type":"application/json"}}})},getModelName:function(){return"TripleFitness.model.CatalogModel"},detailsTpl:new Ext.XTemplate('<div class="judge-details-item"><h4>{title}</h4><tpl if="img"><img src="{img}"/></tpl><small>{description}',"</small></div>",{disableFormats:true}),onItemTap:function(f,d,e,a,g){var c=this;if(a.get("leaf")==true){var h=this.getListViewContainer();this.detailsTpl.overwrite(Ext.get("catalogDetailsContent"),a.data);var b=a.get("price");if(b){this.getPriceVal().setHtml('<span class="price-hack">'+b.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")+"</span>")}Ext.getCmp("catalogItemId").setValue(a.get("id"));h.setActiveItem(1)}else{var i=this.getListView();this.stores.push(i.getStore());this.loadModel(this.getModelName(),a.get("id"),function(j){c.processProperties(j.data.data);c.buildStore(i,j.data.data)})}this.getBackBtn().removeCls("no_bg")},stores:[],catalogMessageDialogRef:null,showCatalogMessageDialog:function(){this.catalogMessageDialogRef=Ext.create("TripleFitness.view.CatalogMessageDialog");this.catalogMessageDialogRef.setZIndex(9);if(userId<=0){Ext.getCmp("catalogName").show();Ext.getCmp("catalogPhone").show()}else{Ext.getCmp("catalogName").hide();Ext.getCmp("catalogPhone").hide()}Ext.Viewport.add(this.catalogMessageDialogRef)},hideCatalogMessageDialog:function(){Ext.Viewport.remove(this.catalogMessageDialogRef,true)},sendCatalogMessage:function(){var f=Ext.getCmp("catalogItemId").getValue();var a=new Date(Ext.getCmp("catalogDate").getValue());var e=Ext.getCmp("catalogTime").getValue().split(".");a.setHours(e[0]);a.setMinutes(e[1]);var d=Ext.getCmp("catalogSpecialist").getValue();var c=Ext.getCmp("catalogName").getValue();var b=Ext.getCmp("catalogPhone").getValue();var g=Ext.getCmp("catalogRemarks").getValue();if(a&&e.length==2){if(userId<=0&&(!c||!b)){Ext.Msg.alert("Ошибка","Пожалуйста, введите свое имя и телефон.");return}if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){Ext.Ajax.request({url:"http://mail2.evo-club.by:8080/EvoWebJSON/Service.asmx/ServiceReservation",method:"GET",headers:{"Content-type":"application/json"},params:{item_id:f,person_id:d,client_id:userId,client_name:'"'+c+'"',phone:'"'+b+'"',descr:'"'+g+'"',date:JSON.stringify(a)},success:function(h){if(JSON.parse(h.responseText).d=="success"){Ext.Msg.alert("Информация","Ваш заказ принят.")}},failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка, попробуйте отправить заказ позже.")}})}else{Ext.Msg.alert("Ошибка","Отсутствует подключение к интернету.")}Ext.Viewport.remove(this.catalogMessageDialogRef,true)}else{Ext.Msg.alert("Ошибка","Пожалуйста, выберите дату и время.")}},specialistsStore:null,prevDate:null,prevTime:null,setSpecialistData:function(){var a=new Date(Ext.getCmp("catalogDate").getValue());var c=Ext.getCmp("catalogTime").getValue().split(".");a.setHours(c[0]);a.setMinutes(c[1]);var b=Ext.getCmp("catalogSpecialist");if(a!=this.prevDate||c!=this.prevTime){if(a&&c){this.prevDate=a;this.prevTime=c;this.specialistsStore.getProxy().setExtraParams({id:248,client_id:userId,date_start:JSON.stringify(a)});b.setStore(this.specialistsStore);this.specialistsStore.load()}else{b.getStore().setData([])}}},prepareToLoad:function(a){a.getProxy().setExtraParams({client_id:userId})}});Ext.define("TripleFitness.controller.ScheduleController",{extend:"TripleFitness.controller.ListBaseController",requires:["Ext.data.Store"],config:{refs:{listView:"#ScheduleList",btnMonday:"#btnMonday"}},listModelId:218,buildStore:function(b,a){b.setStore(Ext.create("Ext.data.Store",{model:"TripleFitness.model.ListItemModel",filters:[{property:"day",value:"пн"}],data:a}));this.getBtnMonday().addCls("active")},filterList:function(a){this.getListView().getStore().clearFilter();this.getListView().getStore().filter("day",a.getText().toLowerCase());Ext.select("#ScheduleView .x-button").removeCls("active");a.addCls("active")},orderScheduleItem:function(a){Ext.Msg.confirm("Подтверждение","Вы уверены, что хотите принять участие?",function(b){if(b=="yes"){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){Ext.Ajax.request({url:"http://evo.sib.by/schedule.html",method:"POST",params:{id:a.get("id"),userId:userId},success:function(c){Ext.Msg.alert("Информация","Ваш заявка принята.")},failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка, попробуйте отправить заявку позже.")}})}else{Ext.Msg.alert("Ошибка","Отсутствует подключение к интернету.")}}})}});Ext.define("TripleFitness.controller.FitobarController",{extend:"TripleFitness.controller.ListBaseController",config:{refs:{listView:"#fitobarList",listViewContainer:"#FitobarView",backBtn:"#backBtnH",priceVal:"#priceVal"}},listModelId:248,detailsTpl:new Ext.XTemplate('<div class="judge-details-item"><h4>{title}</h4><tpl if="img"><img src="{img}"/></tpl><small>{description}',"</small></div>",{disableFormats:true}),onItemTap:function(f,d,e,a,g){var c=this;if(a.get("leaf")==true){var h=this.getListViewContainer();this.detailsTpl.overwrite(Ext.get("fitobarDetailsContent"),a.data);var b=userId>0?a.get("price_club"):a.get("price");this.getPriceVal().setHtml('<span class="price-hack">'+b.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")+"</span>");Ext.getCmp("fitobarItemId").setValue(a.get("id"));h.setActiveItem(1)}else{var i=this.getListView();this.stores.push(i.getStore());this.loadModel("TripleFitness.model.ListModel",a.get("id"),function(j){c.processProperties(j.data.data);c.buildStore(i,j.data.data)})}this.getBackBtn().removeCls("no_bg")},stores:[],orderBarItem:function(){var a=Ext.getCmp("fitobarItemId").getValue();if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){Ext.Ajax.request({url:"http://evo.sib.by/fitobar.html",method:"POST",params:{id:a,userId:userId},success:function(b){Ext.Msg.alert("Информация","Ваш заказ принят.")},failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка, попробуйте сделать заказ позже.")}})}else{Ext.Msg.alert("Ошибка","Отсутствует подключение к интернету.")}Ext.Viewport.remove(this.catalogMessageDialogRef,true)}});Ext.define("TripleFitness.controller.MagazineMainController",{extend:"TripleFitness.controller.ListBaseController",requires:["Ext.data.Store","Ext.Carousel"],config:{refs:{carousel:"#magazinepreview",mainMagazine:"#MagazineMainView",articleCarousel:"#atrcilepreview",articleList:"#articlelist",magazineList:"#MagazineListView",backBtn:"#backBtnH"}},listModelId:315,loadArticleContent:function(a){var c=this.getMagazineList();var b=new Ext.Template("<h4>{title}</h4><div>{content}</div>");c.removeAt(1);c.add({xtype:"container",layout:"fit",id:"articleentry",html:b.apply(a.data||a),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true});c.setActiveItem(1)},magazineTap:function(b){var a=this.getMainMagazine();var c=Ext.create("TripleFitness.view.MagazineList");this.loadListData(b.id);a.add(c);a.setActiveItem(1)},loadListData:function(a){var d=this.getArticleCarousel();var c=this.getArticleList();var b=this;this.loadModel("TripleFitness.model.ListModel",a,function(f){var e=f.data.data;Ext.Array.remove(e,e[e.length-1]);d.on({tap:function(g){b.loadArticleContent.call(b,e[d.getActiveIndex()])},element:"element",delegate:"div.magazine-article-cover"});d.removeAll();Ext.each(e,function(h,g){var i=new Ext.Template('<div style="background: url({img}) center no-repeat;background-size:contain;" class="magazine-article-cover"><div class="magazine-article-title">{title}</div></div>');d.add({html:i.apply(h)});return true});c.setStore(Ext.create("Ext.data.Store",{model:"TripleFitness.model.ListItemModel",data:e}))})},loadData:function(){var b=this.getCarousel();var a=this;this.loadModel("TripleFitness.model.ListModel",this.listModelId,function(d){var c=d.data.data;Ext.Array.remove(c,c[c.length-1]);b.on({tap:function(f){a.magazineTap.call(a,c[this.getActiveIndex()]);a.getBackBtn().removeCls("no_bg")},element:"element",delegate:"div.magazine-cover",scope:b});b.removeAll();Ext.each(c,function(f,e){var g=new Ext.Template('<div style="background: url({img}) center no-repeat;background-size:contain;" class="magazine-cover"></div>');b.add({html:g.apply(f)});return true})})}});Ext.define("TripleFitness.view.Gallery",{id:"Gallery",extend:"Ext.Container",xtype:"gallery",requires:["Ext.data.Store","TripleFitness.view.GalleryContainer"],initialize:function(){this.callParent();var a=TripleFitness.app.getController("GalleryController");a.loadData()},config:{layout:"card",items:[{xtype:"list",id:"galleryList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}</small></div>',{disableFormats:true}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(g,e,h,d,f){var c=Ext.create("TripleFitness.view.GalleryContainer");var b=TripleFitness.app.getController("GalleryContainerController");b.loadData(d.get("id"));var a=this.parent;a.add(c);a.setActiveItem(1);Ext.get("backBtnH").removeCls("no_bg")}}}]}});Ext.define("TripleFitness.view.MagazineMain",{extend:"Ext.Container",xtype:"magazinemain",id:"MagazineMainView",requires:["Ext.data.Store","TripleFitness.view.MagazineList","Ext.Carousel"],initialize:function(){this.callParent();controller=TripleFitness.app.getController("MagazineMainController");controller.loadData()},controller:null,config:{layout:"card",items:[{xtype:"carousel",layout:"fit",id:"magazinepreview"}]}});Ext.define("TripleFitness.controller.MainMenuController",{extend:Ext.app.Controller,requires:["TripleFitness.view.News","TripleFitness.view.Info","TripleFitness.view.Catalog","TripleFitness.view.Gallery","TripleFitness.view.Schedule","TripleFitness.view.Fitobar","TripleFitness.view.Consulting","TripleFitness.view.Tour","TripleFitness.view.MagazineMain","TripleFitness.model.ListModel","TripleFitness.model.ListItemModel"],config:{refs:{mainPanel:"#MainPanel",mainContainer:"#MainContainer",btnGallery:"#galleryBtn",btnNews:"#newsBtn",btnInfo:"#infoBtn",btnServices:"#servicesBtn",btnSchedule:"#scheduleBtn",btnFitobar:"#fitobarBtn",btnConsulting:"#consultingBtn",btnMagazine:"#magazineBtn",btnTour:"#tourBtn",btnGalleryF:"#galleryBtnF",btnNewsF:"#newsBtnF",btnServicesF:"#servicesBtnF",btnScheduleF:"#scheduleBtnF",btnFitobarF:"#fitobarBtnF",btnConsultingF:"#consultingBtnF",btnMagazineF:"#magazineBtnF",btnInfoH:"#infoBtnH",btnBackH:"#backBtnH"},control:{btnGallery:{tap:"onGallery"},btnNews:{tap:"onNews"},btnInfo:{tap:"onInfo"},btnServices:{tap:"onServices"},btnSchedule:{tap:"onSchedule"},btnFitobar:{tap:"onFitobar"},btnConsulting:{tap:"onConsulting"},btnTour:{tap:"onTour"},btnConsultingF:{tap:"onConsultingF"},btnMagazineF:{tap:"onMagazineF"},btnMagazine:{tap:"onMagazine"},btnNewsF:{tap:"onNewsF"},btnServicesF:{tap:"onServicesF"},btnScheduleF:{tap:"onScheduleF"},btnFitobarF:{tap:"onFitobarF"},btnInfoH:{tap:"onInfoH"},btnBackH:{tap:"onBackH"}}},removeActiveCls:function(){Ext.select("#Footer div.x-layout-box-item, #Header div.x-layout-box-item").removeCls("active")},onGallery:function(){this.switchToGallery();this.getMainPanel().setActiveItem(1)},onServices:function(){this.switchToServices();this.getMainPanel().setActiveItem(1)},onInfo:function(){this.switchToInfo();this.getMainPanel().setActiveItem(1)},onNews:function(){this.switchToNews();this.getMainPanel().setActiveItem(1)},onSchedule:function(){this.switchToSchedule();this.getMainPanel().setActiveItem(1)},onFitobar:function(){this.switchToFitobar();this.getMainPanel().setActiveItem(1)},onConsulting:function(){this.switchToConsulting();this.getMainPanel().setActiveItem(1)},onMagazine:function(){this.switchToMagazine();this.getMainPanel().setActiveItem(1)},onTour:function(){this.switchToTour();this.getMainPanel().setActiveItem(1)},onInfoH:function(a){this.getMainPanel().setActiveItem(0);this.getBtnBackH().addCls("no_bg");this.removeActiveCls()},onBackH:function(){var g=this.getMainContainer().getActiveItem();var f=g.getId();if(Ext.get(this.getBtnBackH().getId()).hasCls("no_bg")==false&&(f=="NewsView"||f=="InfoView"||f=="CatalogView"||f=="Gallery"||f=="ScheduleView"||f=="FitobarView"||f=="MagazineMainView")){if(f=="MagazineMainView"&&g.getActiveItem().getActiveItem().getId()=="articleentry"){g=g.getActiveItem()}else{if(f=="FitobarView"){if(g.getActiveItem().getActiveItem().getId()!="fitobarDetailsContent"){var e=Ext.getCmp("fitobarList");var d=TripleFitness.app.getController("FitobarController");var h=d.stores.pop();e.setStore(h);if(d.stores.length==0){this.getBtnBackH().addCls("no_bg")}return}}else{if(f=="CatalogView"){if(g.getActiveItem().getActiveItem().getId()!="catalogDetailsContent"){var c=Ext.getCmp("catalogList");var b=TripleFitness.app.getController("CatalogController");var a=b.stores.pop();c.setStore(a);if(b.stores.length==0){this.getBtnBackH().addCls("no_bg")}return}}else{this.getBtnBackH().addCls("no_bg")}}}g.getAt(1).setHtml("");g.setActiveItem(0)}},onConsultingF:function(a){this.switchToConsulting();this.getBtnBackH().addCls("no_bg")},onMagazineF:function(a){this.switchToMagazine();this.getBtnBackH().addCls("no_bg")},onServicesF:function(a){this.switchToServices();this.getBtnBackH().addCls("no_bg")},onNewsF:function(a){this.switchToNews();this.getBtnBackH().addCls("no_bg")},onScheduleF:function(){this.switchToSchedule();this.getBtnBackH().addCls("no_bg")},onFitobarF:function(){this.switchToFitobar();this.getBtnBackH().addCls("no_bg")},switchToInfo:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"info"});this.removeActiveCls()},switchToServices:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"catalog"});this.removeActiveCls();this.getBtnServicesF().addCls("active")},switchToGallery:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"gallery"});this.removeActiveCls()},switchToNews:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"news"});this.removeActiveCls()},switchToSchedule:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"schedule"});this.removeActiveCls();this.getBtnScheduleF().addCls("active")},switchToFitobar:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"fitobar"});this.removeActiveCls();this.getBtnFitobarF().addCls("active")},switchToConsulting:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"consulting"});this.removeActiveCls();this.getBtnConsultingF().addCls("active")},switchToMagazine:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"magazinemain"});this.removeActiveCls();this.getBtnMagazineF().addCls("active")},switchToTour:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"tour"});this.removeActiveCls()}});Ext.Loader.setPath({Ext:"sdk/src"});Ext.application({name:"TripleFitness",isIconPrecomposed:true,views:["Main"],controllers:["NewsController","InfoController","LoginController","MainMenuController","GalleryController","CatalogController","GalleryContainerController","ScheduleController","FitobarController","ConsultingController","MagazineMainController"],phoneStartupScreen:"resources/loading/Homescreen.jpg",tabletStartupScreen:"resources/loading/Homescreen~ipad.jpg",launch:function(){Ext.MessageBox.YESNO[0].text=GlobalMessages.No;Ext.MessageBox.YESNO[1].text=GlobalMessages.Yes;overrideDates();Ext.fly("appLoadingIndicator").destroy();if(navigator.network&&navigator.network.connection){if(navigator.network.connection.type==Connection.NONE){Ext.Msg.alert(GlobalMessages.ErrorTitle,GlobalMessages.NoInetOfflineMode)}else{var a=Ext.create("Ext.LoadMask",{message:GlobalMessages.LoadingData,id:"loading"});Ext.Viewport.add(a);a.hide();Ext.Ajax.on("beforerequest",function(){a.show()});Ext.Ajax.on("requestcomplete",function(){a.hide()});Ext.Ajax.on("requestexception",function(){a.hide()})}}Ext.Viewport.add(Ext.create("TripleFitness.view.Main"))},onUpdated:function(){window.location.reload()}});var userId=-1;